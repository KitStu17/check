<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>파일 확장자 차단</title>
        <link rel="stylesheet" th:href="@{/css/style.css}">
    </head>
    <body>
        <div class="container">
            <h1>◎ 파일 확장자 차단 테스트 페이지</h1>

            <!-- 1. 고정 확장자 -->
            <div class="section">
                <div class="section-title">
                    고정 확장자
                </div>
                <div class="fixed-extensions">
                    <div class="checkbox-item" th:each="item : ${fixed}">
                        <input type="checkbox" 
                            th:id="${item.extensionName}" 
                            name="fixedExtension" 
                            th:value="${item.extensionName}"
                            th:checked="${item.isBlocked}">
                        <label th:for="${item.extensionName}" th:text="${item.extensionName}"></label>
                    </div>
                </div>
            </div>

            <!-- 2. 커스텀 확장자 입력 -->
            <div class="section">
                <div class="section-title">
                    커스텀 확장자
                </div>
                <div class="custom-input-area">
                    <input type="text" id="customExtensionInput" placeholder="확장자 입력" maxlength="20">
                    <button class="add-button" onclick="addCustomExtension()">+추가</button>
                </div>
            </div>

            <!-- 3. 커스텀 확장자 표시 -->
            <div class="section">
                <div class="section-title">
                    <span id="extensionCount" th:text="${#lists.size(custom)} + '/200'">0/200</span>
                </div>
                <div class="custom-extensions-display">
                    <div class="extension-tags" id="extensionTags">
                        <div class="extension-tag" th:each="item : ${custom}">
                            <span class="name" th:text="${item.extensionName}"></span>
                            <span class="remove-btn" onclick="removeExtension(this)" th:data-name="${item.extensionName}">✕</span>
                        </div>
                        <div th:if="${#lists.isEmpty(custom)}" class="empty-message">
                            등록된 커스텀 확장자가 없습니다.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // 페이지 로드 시 데이터 불러오기
            window.addEventListener('DOMContentLoaded', function() {
                loadFixedExtensions();
                loadCustomExtensions();
            });

            // 고정 확장자 체크박스 변경 이벤트
            document.querySelectorAll('input[name="fixedExtension"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    updateFixedExtension(this.value, this.checked);
                });
            });

            // 고정 확장자 상태 불러오기
            function loadFixedExtensions() {
                // TODO: API 호출하여 고정 확장자 상태 불러오기
                console.log('고정 확장자 상태 불러오기');
            }

            // 고정 확장자 상태 업데이트
            function updateFixedExtension(extensionName, isBlocked) {
                // TODO: API 호출하여 고정 확장자 상태 업데이트
                console.log(`고정 확장자 업데이트: ${extensionName} = ${isBlocked}`);
            }

            // 커스텀 확장자 불러오기
            function loadCustomExtensions() {
                // TODO: API 호출하여 커스텀 확장자 목록 불러오기
                console.log('커스텀 확장자 목록 불러오기');
                updateExtensionCount();
            }

            // 커스텀 확장자 추가
            function addCustomExtension() {
                const input = document.getElementById('customExtensionInput');
                const extensionName = input.value.trim();

                if (!extensionName) {
                    alert('확장자를 입력해주세요.');
                    return;
                }

                if (extensionName.length > 20) {
                    alert('확장자는 최대 20자까지 입력 가능합니다.');
                    return;
                }

                // TODO: 중복 체크 및 200개 제한 체크

                // TODO: API 호출하여 커스텀 확장자 추가
                console.log(`커스텀 확장자 추가: ${extensionName}`);

                // 임시로 화면에 추가
                addExtensionTag(extensionName);
                input.value = '';
                updateExtensionCount();
            }

            // 확장자 태그 화면에 추가
            function addExtensionTag(extensionName) {
                const tagsContainer = document.getElementById('extensionTags');
                const tag = document.createElement('div');
                tag.className = 'extension-tag';
                tag.innerHTML = `
                    <span class="name">${extensionName}</span>
                    <span class="remove-btn" onclick="removeExtension(this)">✕</span>
                `;
                tagsContainer.appendChild(tag);
            }

            // 확장자 삭제
            function removeExtension(element) {
                const tag = element.parentElement;
                const extensionName = tag.querySelector('.name').textContent;

                if (confirm(`'${extensionName}' 확장자를 삭제하시겠습니까?`)) {
                    // TODO: API 호출하여 커스텀 확장자 삭제
                    console.log(`커스텀 확장자 삭제: ${extensionName}`);

                    tag.remove();
                    updateExtensionCount();
                }
            }

            // 확장자 개수 업데이트
            function updateExtensionCount() {
                const tags = document.querySelectorAll('.extension-tag');
                const count = tags.length;
                document.getElementById('extensionCount').textContent = `${count}/200`;
            }

            // Enter 키로 추가
            document.getElementById('customExtensionInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addCustomExtension();
                }
            });
        </script>
    </body>
</html>